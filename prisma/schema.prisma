generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activity_logs {
  id        String   @id
  userId    String
  event     String
  metadata  Json?
  ipAddress String
  userAgent String
  sessionId String?
  timestamp DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([event])
  @@index([timestamp])
  @@index([userId])
}

model audit_logs {
  id              String          @id
  userId          String
  entityId        String
  ipAddress       String
  userAgent       String
  timestamp       DateTime        @default(now())
  changes         Json?
  signature       String
  action          ActionType
  entityType      EntityType
  inventory_items inventory_items @relation(fields: [entityId], references: [id])
  users           users           @relation(fields: [userId], references: [id])

  @@index([action])
  @@index([entityType, entityId])
  @@index([timestamp])
  @@index([userId])
}

model backup_configs {
  id                     String         @id
  enabled                Boolean        @default(false)
  scheduleTime           String         @default("02:00")
  formats                BackupFormat[]
  includeAuditLogs       Boolean        @default(true)
  retentionDailyDays     Int            @default(30)
  retentionWeeklyWeeks   Int            @default(12)
  retentionMonthlyMonths Int            @default(12)
  storagePath            String
  updatedAt              DateTime
  updatedBy              String
  users                  users          @relation(fields: [updatedBy], references: [id])
}

model backups {
  id               String       @id
  createdAt        DateTime     @default(now())
  fileSize         BigInt
  recordCount      Int
  status           BackupStatus
  checksum         String
  createdBy        String
  dateRangeFrom    DateTime?
  dateRangeTo      DateTime?
  encrypted        Boolean      @default(false)
  filename         String       @unique
  format           BackupFormat
  includeAuditLogs Boolean      @default(false)
  includeSettings  Boolean      @default(false)
  includeUserData  Boolean      @default(false)
  notes            String?
  type             BackupType
  validated        Boolean      @default(false)
  validatedAt      DateTime?
  users            users        @relation(fields: [createdBy], references: [id])

  @@index([createdAt])
  @@index([status])
  @@index([type])
}

model email_logs {
  id           String      @id
  userId       String?
  to           String
  from         String
  subject      String
  template     String
  status       EmailStatus @default(PENDING)
  sentAt       DateTime?
  failedAt     DateTime?
  errorMessage String?
  attempts     Int         @default(0)
  metadata     Json?
  createdAt    DateTime    @default(now())
  users        users?      @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model help_articles {
  id          String            @id
  title       String
  slug        String            @unique
  category    String
  content     String
  tags        String[]
  status      HelpArticleStatus @default(DRAFT)
  views       Int               @default(0)
  helpful     Int               @default(0)
  notHelpful  Int               @default(0)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime
  publishedAt DateTime?

  @@index([category])
  @@index([slug])
  @@index([status])
}

model inventory_items {
  id          String       @id
  itemName    String
  batch       String
  quantity    Int
  reject      Int          @default(0)
  destination Destination
  category    String?
  notes       String?
  enteredById String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  deletedAt   DateTime?
  audit_logs  audit_logs[]
  users       users        @relation(fields: [enteredById], references: [id])

  @@index([batch])
  @@index([createdAt, destination])
  @@index([createdAt])
  @@index([destination])
  @@index([itemName, batch])
  @@index([itemName])
}

model notifications {
  id        String               @id
  userId    String
  type      NotificationType
  title     String
  message   String
  link      String?
  read      Boolean              @default(false)
  readAt    DateTime?
  priority  NotificationPriority @default(NORMAL)
  metadata  Json?
  createdAt DateTime             @default(now())
  expiresAt DateTime?
  users     users                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId, read])
}

model password_reset_tokens {
  id        String    @id
  token     String    @unique
  userId    String    @unique
  expiresAt DateTime
  used      Boolean   @default(false)
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
}

model products {
  id            String   @id
  name          String
  nameAr        String
  sku           String   @unique
  category      String
  description   String?
  descriptionAr String?
  unit          String
  minStockLevel Int
  maxStockLevel Int
  reorderPoint  Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model report_schedules {
  id         String            @id
  name       String
  reportType ReportType
  frequency  ScheduleFrequency
  time       String
  recipients String[]
  enabled    Boolean           @default(true)
  config     Json
  lastRun    DateTime?
  nextRun    DateTime
  createdAt  DateTime          @default(now())
  createdBy  String
  users      users             @relation(fields: [createdBy], references: [id])

  @@index([enabled])
  @@index([nextRun])
}

model reports {
  id                String       @id
  title             String
  status            ReportStatus
  type              ReportType
  filePath          String
  fileSize          BigInt
  format            ReportFormat
  generatedAt       DateTime     @default(now())
  generatedBy       String
  includeAIInsights Boolean      @default(false)
  periodFrom        DateTime
  periodTo          DateTime
  users             users        @relation(fields: [generatedBy], references: [id])

  @@index([generatedAt])
  @@index([status])
  @@index([type])
}

model saved_filters {
  id        String   @id
  userId    String
  name      String
  filters   Json
  page      String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, page])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  browser      String?
  createdAt    DateTime @default(now())
  deviceType   String?
  ipAddress    String?
  lastActive   DateTime @default(now())
  location     String?
  os           String?
  userAgent    String?
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionToken])
  @@index([userId])
}

model system_settings {
  id          String   @id
  key         String   @unique
  value       Json
  updatedById String
  updatedAt   DateTime
  category    String
  users       users    @relation(fields: [updatedById], references: [id])

  @@index([category])
}

model transactions {
  id              String          @id
  inventoryItemId String
  type            TransactionType
  quantity        Int
  reason          String?
  performedBy     String
  createdAt       DateTime        @default(now())
}

model two_factor_auth {
  id          String    @id
  userId      String    @unique
  secret      String
  backupCodes String[]
  enabled     Boolean   @default(false)
  enabledAt   DateTime?
  lastUsedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  users       users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                    String                 @id
  email                 String                 @unique
  name                  String
  passwordHash          String
  role                  UserRole
  isActive              Boolean                @default(true)
  preferences           Json?                  @default("{}")
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  emailVerified         Boolean                @default(false)
  emailVerifiedAt       DateTime?
  lastLogin             DateTime?
  lastLoginIp           String?
  lockedUntil           DateTime?
  passwordChangedAt     DateTime?
  activity_logs         activity_logs[]
  audit_logs            audit_logs[]
  backup_configs        backup_configs[]
  backups               backups[]
  email_logs            email_logs[]
  inventory_items       inventory_items[]
  notifications         notifications[]
  password_reset_tokens password_reset_tokens?
  report_schedules      report_schedules[]
  reports               reports[]
  saved_filters         saved_filters[]
  sessions              sessions[]
  system_settings       system_settings[]
  two_factor_auth       two_factor_auth?

  @@index([email])
}

enum ActionType {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  VIEW
  REVERT
  BACKUP
  RESTORE
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
}

enum BackupFileType {
  CSV
  JSON
  SQL
}

enum BackupFormat {
  CSV
  JSON
  SQL
}

enum BackupStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
  CORRUPTED
}

enum BackupType {
  MANUAL
  AUTOMATIC
  PRE_RESTORE
}

enum Destination {
  MAIS
  FOZAN
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
  BOUNCED
}

enum EntityType {
  InventoryItem
  User
  Report
  Backup
  Settings
  AuditLog
}

enum HelpArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ItemStatus {
  AVAILABLE
  RESERVED
  EXPIRED
  DAMAGED
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum NotificationType {
  SYSTEM
  ACTIVITY
  APPROVAL
  ALERT
  MENTION
}

enum ReportFormat {
  PDF
  EXCEL
  PPTX
}

enum ReportStatus {
  GENERATING
  COMPLETED
  FAILED
}

enum ReportType {
  MONTHLY_INVENTORY
  YEARLY_SUMMARY
  CUSTOM_RANGE
  AUDIT_REPORT
  USER_ACTIVITY
  CATEGORY_ANALYSIS
}

enum ScheduleFrequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum TransactionType {
  RECEIVE
  ISSUE
  ADJUST
  TRANSFER
  DISPOSE
}

enum UserRole {
  ADMIN
  DATA_ENTRY
  SUPERVISOR
  MANAGER
  AUDITOR
}
